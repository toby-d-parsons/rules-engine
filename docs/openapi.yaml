openapi: 3.1.0
info:
  title: Rules Engine
  description: |
    Rule evaluation API for validating input data against defined rules.
  version: 1.0.0

servers:
  - url: https://api.example.com/api/v1

paths:
  /rules:
    get:
      summary: List rules
      description: Returns a JSON array of rules as objects
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Rule'
    post:
      summary: Create rule
      description: Add a new rule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Rule'
            examples:
              booleanExample:
                $ref: '#/components/examples/booleanExample'
              numericExample:
                $ref: '#/components/examples/numericExample'
              dateTimeExample:
                $ref: '#/components/examples/dateTimeExample'
              dateExample:
                $ref: '#/components/examples/dateExample'
              stringExample:
                $ref: '#/components/examples/stringExample'
      responses:
        '201':
          description: Created
          headers:
            Location:
              description: URL of the newly created rule.
              schema:
                type: string
                format: uri
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rule'
        '422':
          description: Validation failed
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '400':
          description: Bad request.



components:
  examples:
    booleanExample:
      value:
        field: "xyz_isComplianceRequired"
        operator: "equals"
        value: true
        name: "complianceRequired"
    numericExample:
      value:
        field: "xyz_outstandingBalance"
        operator: "greater_than"
        value: 5000
        name: "highOutstandingBalance"
    dateTimeExample:
      value:
        field: "xyz_lastUpdatedDateTime"
        operator: "before"
        value: "2026-12-25T17:00:00Z"
        name: "notUpdatedBeforeSlaDeadline"
    dateExample:
      value:
        field: "xyz_contractStartDate"
        operator: "after"
        value: "2025-12-31"
        name: "contractStartedIn2026"
    stringExample:
      value:
        field: "xyz_subject"
        operator: "contains"
        value: "leak"
        name: "potentialWaterLeak"
  schemas:
    Rule:
      type: object
      required: [field, operator, value, name]
      properties:
        id:
          type: integer
          format: int64
          readonly: true
          description: |
            Unique identifier generated by the system.
        field:
          type: string
        operator:
          type: string
          enum: [equals, not_equals, greater_than, less_than, between, before, after, contains, starts_with, ends_with]
          description: |
            Allowed operators depend on the value's type.
            - boolean: equals, not_equals
            - numeric: equals, not_equals, greater_than, less_than, between
            - date-time: before, after, between
            - date: before, after, between
            - string: equals, not_equals, contains, starts_with, ends_with
        value:
          type: [string, number, boolean]
          description: |
            Value to compare operator against.
        name:
          type: string
          minLength: 3
          maxLength: 255
          description: |
            Must be unique across all rules.
            Duplicate values will result in a 422 error.
        created_at:
          type: string
          format: date-time
          readonly: true
        updated_at:
          type: string
          format: date-time
          readonly: true
    Problem:
      type: object
      required: [type, title]
      properties:
        type:
          type: string
          format: uri
          description: URI identifying the problem type.
        title:
          type: string
          description: Short, human-readable summary of the problem.
        details:
          type: string
          description: Human-readable explanation specific to this occurrence. Equivalent in intent to RFC 7807 'detail'
        validation:
          type: array
          description: Field-level validation errors.
          items:
            type: object
            required: [field, message]
            properties:
              field:
                type: string
                description: Name of the field that failed validation.
              message:
                type: string
                description: Description of the validation error.
